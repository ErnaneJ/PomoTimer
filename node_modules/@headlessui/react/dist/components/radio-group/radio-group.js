import O,{createContext as Q,useCallback as v,useContext as V,useMemo as F,useReducer as X,useRef as M}from"react";import{forwardRefWithAs as N,render as W,compact as Y}from"../../utils/render.js";import{useId as K}from"../../hooks/use-id.js";import{match as Z}from"../../utils/match.js";import{useIsoMorphicEffect as w}from"../../hooks/use-iso-morphic-effect.js";import{Keys as P}from"../../components/keyboard.js";import{focusIn as j,Focus as x,FocusResult as B,sortByDomNode as ee}from"../../utils/focus-management.js";import{useFlags as te}from"../../hooks/use-flags.js";import{Label as re,useLabels as $}from"../../components/label/label.js";import{Description as oe,useDescriptions as J}from"../../components/description/description.js";import{useTreeWalker as ie}from"../../hooks/use-tree-walker.js";import{useSyncRefs as q}from"../../hooks/use-sync-refs.js";import{VisuallyHidden as ne}from"../../internal/visually-hidden.js";import{attemptSubmit as ae,objectToFormEntries as le}from"../../utils/form.js";import{getOwnerDocument as pe}from"../../utils/owner.js";var de=(t=>(t[t.RegisterOption=0]="RegisterOption",t[t.UnregisterOption=1]="UnregisterOption",t))(de||{});let se={[0](n,o){let t=[...n.options,{id:o.id,element:o.element,propsRef:o.propsRef}];return{...n,options:ee(t,r=>r.element.current)}},[1](n,o){let t=n.options.slice(),r=n.options.findIndex(m=>m.id===o.id);return r===-1?n:(t.splice(r,1),{...n,options:t})}},U=Q(null);U.displayName="RadioGroupContext";function z(n){let o=V(U);if(o===null){let t=new Error(`<${n} /> is missing a parent <RadioGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,z),t}return o}function ue(n,o){return Z(o.type,se,n,o)}let ce="div",fe=N(function(o,t){let{value:r,name:m,onChange:f,disabled:R=!1,...I}=o,[{options:a},A]=X(ue,{options:[]}),[T,C]=$(),[k,c]=J(),y=`headlessui-radiogroup-${K()}`,g=M(null),b=q(g,t),E=F(()=>a.find(e=>!e.propsRef.current.disabled),[a]),D=F(()=>a.some(e=>e.propsRef.current.value===r),[a,r]),s=v(e=>{var i;if(R||e===r)return!1;let d=(i=a.find(p=>p.propsRef.current.value===e))==null?void 0:i.propsRef.current;return d!=null&&d.disabled?!1:(f(e),!0)},[f,r,R,a]);ie({container:g.current,accept(e){return e.getAttribute("role")==="radio"?NodeFilter.FILTER_REJECT:e.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(e){e.setAttribute("role","none")}});let h=v(e=>{let d=g.current;if(!d)return;let i=pe(d),p=a.filter(l=>l.propsRef.current.disabled===!1).map(l=>l.element.current);switch(e.key){case P.Enter:ae(e.currentTarget);break;case P.ArrowLeft:case P.ArrowUp:if(e.preventDefault(),e.stopPropagation(),j(p,x.Previous|x.WrapAround)===B.Success){let u=a.find(G=>G.element.current===(i==null?void 0:i.activeElement));u&&s(u.propsRef.current.value)}break;case P.ArrowRight:case P.ArrowDown:if(e.preventDefault(),e.stopPropagation(),j(p,x.Next|x.WrapAround)===B.Success){let u=a.find(G=>G.element.current===(i==null?void 0:i.activeElement));u&&s(u.propsRef.current.value)}break;case P.Space:{e.preventDefault(),e.stopPropagation();let l=a.find(u=>u.element.current===(i==null?void 0:i.activeElement));l&&s(l.propsRef.current.value)}break}},[g,a,s]),L=v(e=>(A({type:0,...e}),()=>A({type:1,id:e.id})),[A]),S=F(()=>({registerOption:L,firstOption:E,containsCheckedOption:D,change:s,disabled:R,value:r}),[L,E,D,s,R,r]),_={ref:b,id:y,role:"radiogroup","aria-labelledby":T,"aria-describedby":k,onKeyDown:h};return O.createElement(c,{name:"RadioGroup.Description"},O.createElement(C,{name:"RadioGroup.Label"},O.createElement(U.Provider,{value:S},m!=null&&r!=null&&le({[m]:r}).map(([e,d])=>O.createElement(ne,{...Y({key:e,as:"input",type:"radio",checked:d!=null,hidden:!0,readOnly:!0,name:e,value:d})})),W({ourProps:_,theirProps:I,defaultTag:ce,name:"RadioGroup"}))))});var be=(t=>(t[t.Empty=1]="Empty",t[t.Active=2]="Active",t))(be||{});let me="div",Re=N(function(o,t){let r=M(null),m=q(r,t),f=`headlessui-radiogroup-option-${K()}`,[R,I]=$(),[a,A]=J(),{addFlag:T,removeFlag:C,hasFlag:k}=te(1),{value:c,disabled:y=!1,...g}=o,b=M({value:c,disabled:y});w(()=>{b.current.value=c},[c,b]),w(()=>{b.current.disabled=y},[y,b]);let{registerOption:E,disabled:D,change:s,firstOption:h,containsCheckedOption:L,value:S}=z("RadioGroup.Option");w(()=>E({id:f,element:r,propsRef:b}),[f,E,r,o]);let _=v(()=>{var H;!s(c)||(T(2),(H=r.current)==null||H.focus())},[T,s,c]),e=v(()=>T(2),[T]),d=v(()=>C(2),[C]),i=(h==null?void 0:h.id)===f,p=D||y,l=S===c,u={ref:m,id:f,role:"radio","aria-checked":l?"true":"false","aria-labelledby":R,"aria-describedby":a,"aria-disabled":p?!0:void 0,tabIndex:(()=>p?-1:l||!L&&i?0:-1)(),onClick:p?void 0:_,onFocus:p?void 0:e,onBlur:p?void 0:d},G=F(()=>({checked:l,disabled:p,active:k(2)}),[l,p,k]);return O.createElement(A,{name:"RadioGroup.Description"},O.createElement(I,{name:"RadioGroup.Label"},W({ourProps:u,theirProps:g,slot:G,defaultTag:me,name:"RadioGroup.Option"})))}),Ne=Object.assign(fe,{Option:Re,Label:re,Description:oe});export{Ne as RadioGroup};
