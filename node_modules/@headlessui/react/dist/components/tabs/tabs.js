import H,{Fragment as Y,createContext as K,useCallback as O,useContext as $,useMemo as h,useReducer as Z,useRef as U,useEffect as w}from"react";import{render as I,Features as z,forwardRefWithAs as v}from"../../utils/render.js";import{useId as V}from"../../hooks/use-id.js";import{match as q}from"../../utils/match.js";import{Keys as m}from"../../components/keyboard.js";import{focusIn as L,Focus as P,sortByDomNode as J}from"../../utils/focus-management.js";import{useIsoMorphicEffect as k}from"../../hooks/use-iso-morphic-effect.js";import{useSyncRefs as D}from"../../hooks/use-sync-refs.js";import{useResolveButtonType as ee}from"../../hooks/use-resolve-button-type.js";import{useLatestValue as Q}from"../../hooks/use-latest-value.js";import{FocusSentinel as te}from"../../internal/focus-sentinel.js";var ne=(r=>(r[r.SetSelectedIndex=0]="SetSelectedIndex",r[r.SetOrientation=1]="SetOrientation",r[r.SetActivation=2]="SetActivation",r[r.RegisterTab=3]="RegisterTab",r[r.UnregisterTab=4]="UnregisterTab",r[r.RegisterPanel=5]="RegisterPanel",r[r.UnregisterPanel=6]="UnregisterPanel",r[r.ForceRerender=7]="ForceRerender",r))(ne||{});let re={[0](e,t){let n=e.tabs.filter(u=>{var l;return!((l=u.current)!=null&&l.hasAttribute("disabled"))});if(t.index<0)return{...e,selectedIndex:e.tabs.indexOf(n[0])};if(t.index>e.tabs.length)return{...e,selectedIndex:e.tabs.indexOf(n[n.length-1])};let i=e.tabs.slice(0,t.index),s=[...e.tabs.slice(t.index),...i].find(u=>n.includes(u));return s?{...e,selectedIndex:e.tabs.indexOf(s)}:e},[1](e,t){return e.orientation===t.orientation?e:{...e,orientation:t.orientation}},[2](e,t){return e.activation===t.activation?e:{...e,activation:t.activation}},[3](e,t){return e.tabs.includes(t.tab)?e:{...e,tabs:J([...e.tabs,t.tab],n=>n.current)}},[4](e,t){return{...e,tabs:J(e.tabs.filter(n=>n!==t.tab),n=>n.current)}},[5](e,t){return e.panels.includes(t.panel)?e:{...e,panels:[...e.panels,t.panel]}},[6](e,t){return{...e,panels:e.panels.filter(n=>n!==t.panel)}},[7](e){return{...e}}},G=K(null);G.displayName="TabsContext";let W=K(null);W.displayName="TabsSSRContext";function j(e){let t=$(W);if(t===null){let n=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,j),n}return t}function M(e){let t=$(G);if(t===null){let n=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,M),n}return t}function ae(e,t){return q(t.type,re,e,t)}let oe=Y,le=v(function(t,n){let{defaultIndex:i=0,vertical:T=!1,manual:s=!1,onChange:u,selectedIndex:l=null,...r}=t;const c=T?"vertical":"horizontal",b=s?"manual":"auto";let y=D(n),[a,p]=Z(ae,{selectedIndex:l!=null?l:i,tabs:[],panels:[],orientation:c,activation:b}),A=h(()=>({selectedIndex:a.selectedIndex}),[a.selectedIndex]),d=Q(u||(()=>{})),x=Q(a.tabs);w(()=>{p({type:1,orientation:c})},[c]),w(()=>{p({type:2,activation:b})},[b]),k(()=>{let f=l!=null?l:i;p({type:0,index:f})},[l]);let R=U(a.selectedIndex);w(()=>{R.current=a.selectedIndex},[a.selectedIndex]);let g=h(()=>[a,{dispatch:p,change(f){R.current!==f&&d.current(f),R.current=f,p({type:0,index:f})}}],[a,p]),S=U({tabs:[],panels:[]}),_={ref:y};return H.createElement(W.Provider,{value:S},H.createElement(G.Provider,{value:g},H.createElement(te,{onFocus:()=>{var f,F;for(let C of x.current)if(((f=C.current)==null?void 0:f.tabIndex)===0)return(F=C.current)==null||F.focus(),!0;return!1}}),I({ourProps:_,theirProps:r,slot:A,defaultTag:oe,name:"Tabs"})))}),ie="div",se=v(function(t,n){let[{selectedIndex:i,orientation:T}]=M("Tab.List"),s=D(n);return I({ourProps:{ref:s,role:"tablist","aria-orientation":T},theirProps:t,slot:{selectedIndex:i},defaultTag:ie,name:"Tabs.List"})}),ue="button",ce=v(function(t,n){var N,B;let i=`headlessui-tabs-tab-${V()}`,[{selectedIndex:T,tabs:s,panels:u,orientation:l,activation:r},{dispatch:c,change:b}]=M("Tab"),y=j("Tab"),a=U(null),p=D(a,n,o=>{!o||c({type:7})});k(()=>(c({type:3,tab:a}),()=>c({type:4,tab:a})),[c,a]);let A=y.current.tabs.indexOf(i);A===-1&&(A=y.current.tabs.push(i)-1);let d=s.indexOf(a);d===-1&&(d=A);let x=d===T,R=O(o=>{let E=s.map(X=>X.current).filter(Boolean);if(o.key===m.Space||o.key===m.Enter){o.preventDefault(),o.stopPropagation(),b(d);return}switch(o.key){case m.Home:case m.PageUp:return o.preventDefault(),o.stopPropagation(),L(E,P.First);case m.End:case m.PageDown:return o.preventDefault(),o.stopPropagation(),L(E,P.Last)}return q(l,{vertical(){if(o.key===m.ArrowUp)return L(E,P.Previous|P.WrapAround);if(o.key===m.ArrowDown)return L(E,P.Next|P.WrapAround)},horizontal(){if(o.key===m.ArrowLeft)return L(E,P.Previous|P.WrapAround);if(o.key===m.ArrowRight)return L(E,P.Next|P.WrapAround)}})},[s,l,d,b]),g=O(()=>{var o;(o=a.current)==null||o.focus()},[a]),S=O(()=>{var o;(o=a.current)==null||o.focus(),b(d)},[b,d,a]),_=O(o=>{o.preventDefault()},[]),f=h(()=>({selected:x}),[x]),F=t,C={ref:p,onKeyDown:R,onFocus:r==="manual"?g:S,onMouseDown:_,onClick:S,id:i,role:"tab",type:ee(t,a),"aria-controls":(B=(N=u[d])==null?void 0:N.current)==null?void 0:B.id,"aria-selected":x,tabIndex:x?0:-1};return I({ourProps:C,theirProps:F,slot:f,defaultTag:ue,name:"Tabs.Tab"})}),pe="div",de=v(function(t,n){let[{selectedIndex:i}]=M("Tab.Panels"),T=D(n),s=h(()=>({selectedIndex:i}),[i]);return I({ourProps:{ref:T},theirProps:t,slot:s,defaultTag:pe,name:"Tabs.Panels"})}),fe="div",Te=z.RenderStrategy|z.Static,be=v(function(t,n){var R,g;let[{selectedIndex:i,tabs:T,panels:s},{dispatch:u}]=M("Tab.Panel"),l=j("Tab.Panel"),r=`headlessui-tabs-panel-${V()}`,c=U(null),b=D(c,n,S=>{!S||u({type:7})});k(()=>(u({type:5,panel:c}),()=>u({type:6,panel:c})),[u,c]);let y=l.current.panels.indexOf(r);y===-1&&(y=l.current.panels.push(r)-1);let a=s.indexOf(c);a===-1&&(a=y);let p=a===i,A=h(()=>({selected:p}),[p]),d=t,x={ref:b,id:r,role:"tabpanel","aria-labelledby":(g=(R=T[a])==null?void 0:R.current)==null?void 0:g.id,tabIndex:p?0:-1};return I({ourProps:x,theirProps:d,slot:A,defaultTag:fe,features:Te,visible:p,name:"Tabs.Panel"})}),we=Object.assign(ce,{Group:le,List:se,Panels:de,Panel:be});export{we as Tab};
