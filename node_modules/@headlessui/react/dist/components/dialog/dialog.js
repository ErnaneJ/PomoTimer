import T,{createContext as le,useCallback as w,useContext as N,useEffect as F,useMemo as h,useReducer as ne,useRef as j,useState as ie,createRef as ae}from"react";import{match as L}from"../../utils/match.js";import{forwardRefWithAs as v,render as A,Features as V}from"../../utils/render.js";import{useSyncRefs as E}from"../../hooks/use-sync-refs.js";import{Keys as se}from"../keyboard.js";import{isDisabledReactIssue7711 as pe}from"../../utils/bugs.js";import{useId as b}from"../../hooks/use-id.js";import{useFocusTrap as de,Features as k}from"../../hooks/use-focus-trap.js";import{useInertOthers as ue}from"../../hooks/use-inert-others.js";import{Portal as M}from"../../components/portal/portal.js";import{ForcePortalRoot as I}from"../../internal/portal-force-root.js";import{Description as fe,useDescriptions as ge}from"../description/description.js";import{useOpenClosed as ce,State as K}from"../../internal/open-closed.js";import{useServerHandoffComplete as Te}from"../../hooks/use-server-handoff-complete.js";import{StackProvider as me,StackMessage as q}from"../../internal/stack-context.js";import{useOutsideClick as De,Features as Pe}from"../../hooks/use-outside-click.js";import{getOwnerDocument as ye}from"../../utils/owner.js";import{useOwnerDocument as Re}from"../../hooks/use-owner.js";import{useEventListener as he}from"../../hooks/use-event-listener.js";var ve=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(ve||{}),Ae=(e=>(e[e.SetTitleId=0]="SetTitleId",e))(Ae||{});let Ee={[0](a,e){return a.titleId===e.id?a:{...a,titleId:e.id}}},_=le(null);_.displayName="DialogContext";function C(a){let e=N(_);if(e===null){let t=new Error(`<${a} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,C),t}return e}function be(a,e){return L(e.type,Ee,a,e)}let Ce="div",Oe=V.RenderStrategy|V.Static,Se=v(function(e,t){let{open:o,onClose:l,initialFocus:p,__demoMode:f=!1,...g}=e,[m,D]=ie(0),O=ce();o===void 0&&O!==null&&(o=L(O,{[K.Open]:!0,[K.Closed]:!1}));let u=j(new Set),d=j(null),z=E(d,t),P=Re(d),x=e.hasOwnProperty("open")||O!==null,G=e.hasOwnProperty("onClose");if(!x&&!G)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!x)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!G)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(typeof o!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${o}`);if(typeof l!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${l}`);let i=o?0:1,[y,B]=ne(be,{titleId:null,descriptionId:null,panelRef:ae()}),R=w(()=>l(!1),[l]),H=w(r=>B({type:0,id:r}),[B]),W=Te()?f?!1:i===0:!1,S=m>1,U=N(_)!==null,J=de(d,W?L(S?"parent":"leaf",{parent:k.RestoreFocus,leaf:k.All&~k.FocusLock}):k.None,{initialFocus:p,containers:u});ue(d,S?W:!1),De(()=>{var n,s;return[...Array.from((n=P==null?void 0:P.querySelectorAll("body > *"))!=null?n:[]).filter(c=>!(!(c instanceof HTMLElement)||c.contains(J.current)||y.panelRef.current&&c.contains(y.panelRef.current))),(s=y.panelRef.current)!=null?s:d.current]},()=>{i===0&&(S||R())},Pe.IgnoreScrollbars),he(P==null?void 0:P.defaultView,"keydown",r=>{r.key===se.Escape&&i===0&&(S||(r.preventDefault(),r.stopPropagation(),R()))}),F(()=>{var Y;if(i!==0||U)return;let r=ye(d);if(!r)return;let n=r.documentElement,s=(Y=r.defaultView)!=null?Y:window,c=n.style.overflow,oe=n.style.paddingRight,re=s.innerWidth-n.clientWidth;return n.style.overflow="hidden",n.style.paddingRight=`${re}px`,()=>{n.style.overflow=c,n.style.paddingRight=oe}},[i,U]),F(()=>{if(i!==0||!d.current)return;let r=new IntersectionObserver(n=>{for(let s of n)s.boundingClientRect.x===0&&s.boundingClientRect.y===0&&s.boundingClientRect.width===0&&s.boundingClientRect.height===0&&R()});return r.observe(d.current),()=>r.disconnect()},[i,d,R]);let[Q,X]=ge(),Z=`headlessui-dialog-${b()}`,ee=h(()=>[{dialogState:i,close:R,setTitleId:H},y],[i,y,R,H]),$=h(()=>({open:i===0}),[i]),te={ref:z,id:Z,role:"dialog","aria-modal":i===0?!0:void 0,"aria-labelledby":y.titleId,"aria-describedby":Q,onClick(r){r.stopPropagation()}};return T.createElement(me,{type:"Dialog",element:d,onUpdate:w((r,n,s)=>{n==="Dialog"&&L(r,{[q.Add](){u.current.add(s),D(c=>c+1)},[q.Remove](){u.current.add(s),D(c=>c-1)}})},[])},T.createElement(I,{force:!0},T.createElement(M,null,T.createElement(_.Provider,{value:ee},T.createElement(M.Group,{target:d},T.createElement(I,{force:!1},T.createElement(X,{slot:$,name:"Dialog.Description"},A({ourProps:te,theirProps:g,slot:$,defaultTag:Ce,features:Oe,visible:i===0,name:"Dialog"}))))))))}),we="div",Fe=v(function(e,t){let[{dialogState:o,close:l}]=C("Dialog.Overlay"),p=E(t),f=`headlessui-dialog-overlay-${b()}`,g=w(u=>{if(u.target===u.currentTarget){if(pe(u.currentTarget))return u.preventDefault();u.preventDefault(),u.stopPropagation(),l()}},[l]),m=h(()=>({open:o===0}),[o]);return A({ourProps:{ref:p,id:f,"aria-hidden":!0,onClick:g},theirProps:e,slot:m,defaultTag:we,name:"Dialog.Overlay"})}),Le="div",ke=v(function(e,t){let[{dialogState:o},l]=C("Dialog.Backdrop"),p=E(t),f=`headlessui-dialog-backdrop-${b()}`;F(()=>{if(l.panelRef.current===null)throw new Error("A <Dialog.Backdrop /> component is being used, but a <Dialog.Panel /> component is missing.")},[l.panelRef]);let g=h(()=>({open:o===0}),[o]);return T.createElement(I,{force:!0},T.createElement(M,null,A({ourProps:{ref:p,id:f,"aria-hidden":!0},theirProps:e,slot:g,defaultTag:Le,name:"Dialog.Backdrop"})))}),_e="div",Me=v(function(e,t){let[{dialogState:o},l]=C("Dialog.Panel"),p=E(t,l.panelRef),f=`headlessui-dialog-panel-${b()}`,g=h(()=>({open:o===0}),[o]);return A({ourProps:{ref:p,id:f},theirProps:e,slot:g,defaultTag:_e,name:"Dialog.Panel"})}),Ie="h2",xe=v(function(e,t){let[{dialogState:o,setTitleId:l}]=C("Dialog.Title"),p=`headlessui-dialog-title-${b()}`,f=E(t);F(()=>(l(p),()=>l(null)),[p,l]);let g=h(()=>({open:o===0}),[o]);return A({ourProps:{ref:f,id:p},theirProps:e,slot:g,defaultTag:Ie,name:"Dialog.Title"})}),ft=Object.assign(Se,{Backdrop:ke,Panel:Me,Overlay:Fe,Title:xe,Description:fe});export{ft as Dialog};
